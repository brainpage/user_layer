<div class="title">
	<%= link_to "Home", rsi_portals_path %>
	<%= link_to "Analysis", "#", :class => "active" %>
	<%= link_to "Activities", rsi_activities_path %>
</div>

<script>

	var margin = {top: 10, right: 10, bottom: 10, left: 10},
		width = 960 - margin.left - margin.right,
		height = 80,
		days = [0, 1, 2, 3, 4];
   
	var formatDate = d3.time.format("%Y-%m-%d %H:%M:%S");
	
	var svg = d3.select(".container").append("svg").attr("width", width).attr("height", (height + 10) * days.length);

	var x = d3.time.scale().range([0, width]),
   		y = d3.scale.linear().range([height, 0]),
		y_brush = d3.scale.linear().range([svg.attr("height"), 0]);

   	
	svg.append("defs").append("clipPath")
             .attr("id", "clip")
             .append("rect")
             .attr("width", width)
             .attr("height", height);

	draw(0);

	function draw(index){
		var day = days[index];

	   	var xAxis = d3.svg.axis().scale(x).orient("bottom");

	    var area = d3.svg.area()
	       	.interpolate("monotone")
	       	.x(function(d) { return x(d.timestamp); })
	       	.y0(height)
	       	.y1(function(d) { return y(d.point); });
		
		d3.json("http://localhost:3000/rsi/charts/data?day=" + day, function(data) {

	   		var stage = svg.append("g")
		   		.attr("transform", "translate(" + margin.left + "," + (margin.top + height * index) + ")");

	   		data.forEach(function(d) {
	   			d.timestamp = formatDate.parse(d.timestamp);
	   	        d.point = +d.point;
	   		});

	   		x.domain(d3.extent(data.map(function(d) { return d.timestamp; })));
	   		y.domain([0, d3.max(data.map(function(d) { return d.point; }))]);

	   	    stage.append("path").data([data]).attr("d", area);

	   	    stage.append("g")
	   	         .attr("class", "x axis")
	   	         .attr("transform", "translate(0," + height + ")")
	   	         .call(xAxis);
	
			if(index < days.length - 1){
				draw(index + 1);
			}else{
				drawBrush();
			}
	   	});
	}
	
	function drawBrush(){
		svg.append("g")
		     .attr("class", "brush")
		     .call(d3.svg.brush().x(x).y(y_brush)
		     .on("brush", brush));
	}	
	
	function brush() {
	
	   console.log(d3.event.target.extent());

	}
	

</script>
